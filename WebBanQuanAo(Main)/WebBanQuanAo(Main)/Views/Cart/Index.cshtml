@model WebBanQuanAo_Main_.Models.ViewModel.Cart
@using PagedList.Mvc;
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_MasterLayout.cshtml";
}

<script type="text/javascript">
    // Hàm cập nhật số lượng giữ nguyên
    function cartUpdateQuantity(id, newQuantity) {
        if (newQuantity < 1) return;
        
        const form = document.createElement('form');
        form.method = 'post';
        form.action = '@Url.Action("UpdateQuantity", "Cart")';

        const idInput = document.createElement('input');
        idInput.type = 'hidden';
        idInput.name = 'id';
        idInput.value = id;
        form.appendChild(idInput);

        const quantityInput = document.createElement('input');
        quantityInput.type = 'hidden';
        quantityInput.name = 'quantity';
        quantityInput.value = newQuantity;
        form.appendChild(quantityInput);

        document.body.appendChild(form);
        form.submit();
    }
</script>

<style>
    .hm-img {
        width: 85%;
        height: 200px;
        object-fit: cover;
    }
</style>

<div class="container mt-5">
    
    <h2 class="fw-bold text-uppercase mb-4">Giỏ hàng</h2>

    <div class="row">
        
        <div class="col-lg-8">
            @if (Model.Items == null || !Model.Items.Any())
            {
                <div class="alert alert-light border">
                    Giỏ hàng trống. 
                    <a href="@Url.Action("Index", "ProductCus")" class="text-warning fw-bold">Quay lại và thêm sản phẩm vào giỏ hàng</a>
                </div>
            }
            else
            {
                foreach (var item in Model.Items)
                {
                    
                    <div class="row mb-4 pb-4 border-bottom">

                        
                        <div class="col-4 col-sm-3">
                            <img src="@Url.Content(item.image)" class="hm-img" alt="Ảnh">
                        </div>

                        
                        <div class="col-8 col-sm-9">
                            <div class="d-flex justify-content-between">
                                <h5 class="fw-bold text-uppercase">@item.namePro</h5>
                                
                                <a href="@Url.Action("RemoveFromCart", "Cart", new { id = item.idPro })" class="text-danger" onclick="return confirm('Xóa?');">
                                    <i class="fa-solid fa-trash-can"></i>
                                </a>
                            </div>

                            <p class="mb-1 text-muted small">Màu: @item.Color</p>
                            <p class="mb-3 text-muted small">Size: @item.Size</p>

                            <div class="d-flex align-items-center justify-content-between">
                                <div class="btn-group border">
                                    <a href="@Url.Action("DecreaseQuantity", "Cart", new { id = item.idPro })" class="btn btn-sm btn-light  px-3">-</a>
                                    <span class="btn btn-sm btn-light rounded-0" style="pointer-events: none;">@item.quantity</span>
                                    <a href="@Url.Action("IncreaseQuantity", "Cart", new { id = item.idPro })" class="btn btn-sm btn-light  px-3">+</a>
                                </div>
                                <span class="fw-bold">@String.Format("{0:N0}", item.total) đ</span>
                            </div>
                        </div>
                    </div>
                }
            }
        </div>    
        <div class="col-lg-4">
            <div class="bg-light p-4">
                <h5 class="fw-bold text-uppercase mb-3">Tổng tiền</h5>
                <div class="d-flex justify-content-between mb-2">
                    <span>Giá trị đơn hàng</span>
                    <span>@String.Format("{0:N0}", Model.TotalValue()) đ</span>
                </div>

                <div class="d-flex justify-content-between border-top border-dark pt-3 mb-4 fw-bold">
                    <span>TỔNG CỘNG</span>
                    <span>@String.Format("{0:N0}", Model.TotalValue()) đ</span>
                </div>

                <a href="@Url.Action("Checkout", "Order")" class="btn btn-dark w-100 py-3 rounded-0 text-uppercase fw-bold">
                    Thanh toán
                </a>
            </div>
        </div>
    </div>
</div>



