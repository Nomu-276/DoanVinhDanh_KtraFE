@model WebBanQuanAo_Main_.Models.Product

@{
    ViewBag.Title = "Chi tiết sản phẩm";
    Layout = "~/Views/Shared/_MasterLayout.cshtml";
    var sizes = ViewBag.Sizes as List<WebBanQuanAo_Main_.Models.Size>;
    var colors = ViewBag.Colors as List<WebBanQuanAo_Main_.Models.Color>;
}

<link href="~/Content/Admin/Detail.css" rel="stylesheet" />

@using (Html.BeginForm("AddToCart", "Cart", FormMethod.Post))
{
    @Html.Hidden("ProductID", Model.ProductID)
    <input type="hidden" id="ColorSelected" name="color" />
    <input type="hidden" id="SizeSelected" name="size" />

    <div class="container" style="margin-top:30px;">
        <div class="row">

            <div class="col-md-7 col-sm-7">
                <img src="@Url.Content(Model.ImagePro)" class="product-image" />
            </div>

            <div class="col-md-5 col-sm-5">

                <h3 style="font-weight:600;">@Model.NamePro</h3>
                <h4 style="font-weight:700;">@String.Format("{0:N0}₫", Model.Price)</h4>

                <div class="section-title">MÀU: @colors.FirstOrDefault().ColorName</div>

                <div>
                    @foreach (var c in colors)
                    {
                        <div class="color-box">
                            <img src="@Url.Content(Model.ImagePro)"
                                 style="width:100%; height:100%; object-fit:cover;"
                                 data-color="@c.ColorName" />
                        </div>
                    }
                </div>

                <div class="clearfix"></div>

                <div class="section-title">CHỌN KÍCH CỠ</div>

                <div>
                    @foreach (var s in sizes)
                    {
                        <div class="size-box">@s.SizeName</div>
                    }
                </div>

                <div class="clearfix"></div>

                <a style="display:block; margin:15px 0; text-decoration:underline;">
                    Hướng dẫn chọn kích cỡ
                </a>

                <button type="submit" class="btn-add-to-cart btn btn-cart">
                    THÊM VÀO GIỎ HÀNG
                </button>

                <div class="section-title">MÔ TẢ SẢN PHẨM</div>
                <p>@Model.DescriptionPro</p>

            </div>
        </div>
    </div>
}
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // 1. Xử lý chọn MÀU SẮC
        var colorImages = document.querySelectorAll('.color-box img');
        colorImages.forEach(function (img) {
            img.addEventListener('click', function () {
                // Xóa viền đỏ ở các ô khác (nếu muốn làm UI đẹp hơn)
                colorImages.forEach(i => i.parentElement.style.border = "1px solid #ccc");

                // Highlight ô được chọn
                this.parentElement.style.border = "2px solid red";

                // Lấy tên màu từ thuộc tính data-color
                var selectedColor = this.getAttribute('data-color');

                // Gán vào input hidden để gửi về server
                document.getElementById('ColorSelected').value = selectedColor;

                console.log("Đã chọn màu: " + selectedColor); // Kiểm tra log (F12)
            });
        });

        // 2. Xử lý chọn KÍCH CỠ (SIZE)
        var sizeBoxes = document.querySelectorAll('.size-box');
        sizeBoxes.forEach(function (box) {
            box.addEventListener('click', function () {
                // Reset style các ô khác
                sizeBoxes.forEach(b => {
                    b.style.backgroundColor = "";
                    b.style.color = "";
                });

                // Highlight ô được chọn (ví dụ: nền đen chữ trắng)
                this.style.backgroundColor = "black";
                this.style.color = "white";

                // Lấy text bên trong ô size
                var selectedSize = this.innerText.trim();

                // Gán vào input hidden
                document.getElementById('SizeSelected').value = selectedSize;

                console.log("Đã chọn size: " + selectedSize);
            });
        });
    });

    // 3. Kiểm tra trước khi Submit form
    // Tìm form có action AddToCart
    var formAddToCart = document.querySelector('form[action*="AddToCart"]');
    if (formAddToCart) {
        formAddToCart.addEventListener('submit', function (e) {
            var size = document.getElementById('SizeSelected').value;
            var color = document.getElementById('ColorSelected').value;

            if (!size || !color) {
                e.preventDefault(); // Chặn không cho gửi
                alert("Vui lòng chọn Màu sắc và Kích cỡ trước khi mua hàng!");
            }
        });
    }
</script>
