
@{
    ViewBag.Title = "DangNhap";
    Layout = "~/Views/Shared/_LayoutTrangChu.cshtml";
}
<link href="~/Content/TrangLamWeb/dangnhap.css" rel="stylesheet" />

<div class="form-b">
    <div class="form-h">
        <h4>Đăng Nhập</h4>
    </div>
    <form class="fm-form" action="#" method="post">
        <h2 class="">Đăng nhập bằng email của bạn hoặc <a href="DangKi">đăng ký</a> để trở thành <br />thành viên NOMIE.</h2>
        <div class="form-mail">
            <label class="nhan" for="mail">Email</label>
            <div><input type="email" name="mail" placeholder="Email" /></div>
        </div>
        <div class="form-pass">
            <label class="nhan" for="pass">Mật khẩu</label>
            <div><input type="password" name="pass" placeholder="Mật khẩu" /></div>
        </div>
        <div class="form-cont">
            <button type="submit">Tiếp tục</button>
        </div>
    </form>
</div>


<script src="~/Scripts/TrangLamWeb/dangnhap.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const form = document.querySelector('.form-b .fm-form')
        if (!form) return

        const current = JSON.parse(localStorage.getItem('currentUser') || 'null')
        if (current && current.email) {
        const emailInput = form.querySelector('input[name="mail"]')
        if (emailInput) emailInput.value = current.email
    }

    form.addEventListener('submit', (e) => {
            e.preventDefault()

        const email = (form.querySelector('input[name="mail"]').value || '').trim().toLowerCase()
        const password = form.querySelector('input[name="pass"]').value || ''

        if (!email || !password) {
            alert('Vui lòng nhập email và mật khẩu.')
            return
        }

        const users = JSON.parse(localStorage.getItem('users') || '[]')
        const user = users.find(u => u.email === email && u.password === password)

        if (!user) {
            alert('Email hoặc mật khẩu không đúng.')
            return
        }

        localStorage.setItem('currentUser', JSON.stringify({email: user.email }))
        alert('Đăng nhập thành công.')
        window.location.href = 'TaiKhoan'
    })
})
</script>

